<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Credit Card Fraud Detection</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">

    <style>
        .feature-block {
            border: 2px;
            padding: 10px;
            margin-bottom: 15px;
            background-color: rgb(255, 255, 255);
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .feature-block:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }

        .col-seventh {
            width: 14.2857143%;
            float: left;
            padding: 0 15px;
            box-sizing: border-box;
            margin-bottom: 10px;
        }

        .form-range {
            width: 100%;
            height: 8px;
            background: #6c757d;
            border-radius: 4px;
            -webkit-appearance: none;
            appearance: none;
        }

        .form-range::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #6c757d;
            border-radius: 50%;
            cursor: pointer;
            margin-top: -6px;
        }

        .form-range::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #6c757d;
            border-radius: 50%;
            cursor: pointer;
        }

        .form-range::-webkit-slider-runnable-track {
            width: 100%;
            height: 8px;
            background: #6c757d;
            border-radius: 4px;
            -webkit-appearance: none;
        }

        .form-range::-moz-range-track {
            width: 100%;
            height: 8px;
            background: #6c757d;
            border-radius: 4px;
            -moz-appearance: none;
        }

        .form-range::-ms-track {
                    width: 100%;
            height: 8px;
            background: #6c757d;
            border-radius: 4px;
            border: none;
        }

        .form-range::-ms-thumb {
            background: #6c757d;
            border-radius: 50%;
            width: 20px;
            height: 20px;
        }

        .form-control {
            margin-top: 5px;
        }

        .navbar-brand i {
            color: rgb(236, 236, 138);
        }

    </style>
    
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">
                <i class="fas fa-credit-card"></i> Credit Card Fraud Detection
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="/">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/bulk_upload">Bulk Transaction Predictions</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container">
        <br>
        <h1 class="mb-4 text-center"><b>Credit Card Fraud Detection</b></h1>
     
        <form action="/" method="post" class="mb-3" novalidate>
            <!--<div class="mb-3">
                <label for="transactions" class="form-label">Enter Feature Values V1-V28 (separated by commas):</label>
                <textarea id="transactions" name="transactions" class="form-control textarea" required>{{ transactions }}</textarea>
            </div>-->
            <div class="card">
                <div class="card-header">
                    Enter Feature Values V1-V28:
                    <button type="button" class="btn btn-secondary btn-sm" style="float:right;" data-bs-toggle="modal" data-bs-target="#featureModal">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>

                <div class="modal fade" id="featureModal" tabindex="-1" aria-labelledby="featureModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="featureModalLabel">Enter Feature Values V1-V28 (separated by commas):</h5>
                        
                    </div>
                    <div class="modal-body">
                        <textarea id="featureValues" class="form-control textarea" placeholder="V1-V28 (separated by commas)" style="height: 200px;"></textarea>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-dark" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-secondary" onclick="fillValues()">Save</button>
                    </div>
                    </div>
                </div>
                </div>

                <div class="card-body">
                    <div class="row">
                        {% for i in range(1, 29) %}
                        <div class="col-seventh feature-block">
                            <label for="V{{i}}" class="form-label">V{{i}}</label>
                        
                            <input type="range" class="form-range" min="-20" max="20" step="0.01" id="sliderV{{i}}" name="V{{i}}" value="{{ feature_values['V' ~ i] }}" oninput="syncValue(this.value, 'textV{{i}}');">
                            <input type="number" step="any" id="textV{{i}}" name="V{{i}}" class="form-control" value="{{ feature_values['V' ~ i] }}" oninput="syncValue(this.value, 'sliderV{{i}}', true);">

                            <br>
                        </div>
                        {% if i % 7 == 0 %}
                            </div><div class="row"> 
                        {% endif %}
                        {% endfor %}
                    </div>
                </div>
            </div>
            <div class="mb-3">
                <label for="amount" class="form-label">Enter Amount:</label>
                <input type="number" id="amount" name="amount" class="form-control" step="0.01" required value="{{ amount }}">
                
            </div>
            <button type="submit" class="btn btn-secondary">Predict</button>
        </form>
        {% if prediction %}
        <div class="alert {{ 'alert-danger' if prediction == 'Fraud' else 'alert-success' }}" style="font-size: 20px; font-weight: bold;">
            Prediction: {{ prediction }}
            <i class="{{ 'fas fa-times' if prediction == 'Fraud' else 'fas fa-check' }}"></i>
            
        </div>
        {% endif %}
    </div>
    <script>
    function syncValue(val, targetId, isText = false) {
        document.getElementById(targetId).value = val;
        if (isText && (parseFloat(val) || parseFloat(val) === 0)) {  
            document.getElementById(targetId.replace('text', 'slider')).value = parseFloat(val);
        }
    }
    function fillValues() {
        var values = document.getElementById('featureValues').value.split(',');
        if (values.length === 28) {
            var allValid = true;
            for (let i = 0; i < values.length; i++) {
                if (isNaN(parseFloat(values[i]))) {
                    allValid = false;
                    alert('Invalid input at position ' + (i + 1));
                    break;
                }
            }
            if (allValid) {
                values.forEach((value, index) => {
                    var preciseValue = parseFloat(value.trim());
                    var inputField = document.getElementById('textV' + (index + 1));
                    var sliderField = document.getElementById('sliderV' + (index + 1));
                    inputField.value = preciseValue; 
                    sliderField.value = preciseValue; 
                });
                var modalElement = document.getElementById('featureModal');
                var modalInstance = bootstrap.Modal.getInstance(modalElement);
                modalInstance.hide();
            }
        } else {
            alert('Please enter exactly 28 numeric values, separated by commas.');
        }
    }



    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
   
</body>
</html>
